function handleFileSelect(t){var a=t.target.files[0];Papa.parse(a,{header:!0,dynamicTyping:!0,complete:function(t){dataObject=t,main()}})}function date_duration_data_parse(t,a,e){for(var r=[],i=0;i<t.length;){for(var n=a[i],o=1,s=i+1;s<t.length;s++)e[i]==e[s]&&(n+=a[s],o++);r.push(n),o>1?i+=o:i++}return{dur_sum:r}}function date_status_data_parse(t,a,e){for(var r=[],i=[],n=[],o=[],s=0;s<t.length;){var d=0,l=0,p=0,c=0,u=1;"passed"==a[s]?d++:"error"==a[s]?l++:"failed"==a[s]?p++:"stopped"==a[s]&&c++,r.push(d),i.push(l),n.push(p),o.push(c);for(var h=s+1;h<t.length;h++)e[s]==e[h]&&("passed"==a[h]?(r[r.length-1]++,u++):"error"==a[h]?(i[i.length-1]++,u++):"failed"==a[h]?(n[n.length-1]++,u++):"stopped"==a[h]&&(o[o.length-1]++,u++));s+=u}return{passed_arr:r,error_arr:i,failed_arr:n,stopped_arr:o}}function main(){var t=new Marionette.Application;t.SessionCollection=Backbone.Collection.extend({}),t.DurationsItemView=Marionette.ItemView.extend({initialize:function(t){this.data=t.data,this.days_data=t.days_data},render:function(){$("#main-region").highcharts({title:{text:"Day/Duration chart",x:-20},xAxis:{title:{text:"Created at"},categories:this.days_data},yAxis:{tickInterval:500,title:{text:"Duration"},plotLines:[{value:0,width:1,color:"#808080"}]},legend:{layout:"vertical",align:"right",verticalAlign:"middle",borderWidth:0},series:[{name:"duration",color:"orange",data:this.data}]})}}),t.StatusesItemView=Marionette.ItemView.extend({initialize:function(t){this.days_data=t.days_data,this.passed=t.passed,this.failed=t.failed,this.error=t.error,this.stopped=t.stopped},render:function(){$("#container").highcharts({chart:{type:"column"},title:{text:"Date/summary status chart"},xAxis:{categories:this.days_data},yAxis:{min:0,title:{text:"Statuses amount"}},legend:{align:"right",x:-30,verticalAlign:"top",y:25,floating:!0,backgroundColor:"white",borderColor:"#CCC",borderWidth:1,shadow:!1},tooltip:{headerFormat:"<b>{point.x}</b><br/>",pointFormat:"{series.name}: {point.y}<br/>Total: {point.stackTotal}"},plotOptions:{column:{stacking:"normal",dataLabels:{enabled:!0,formatter:function(){return 0!=this.y?this.y:void 0},color:"white",style:{textShadow:"0 0 3px black"}}}},series:[{name:"passed",color:"green",data:this.passed},{name:"failed",color:"red",data:this.failed},{name:"error",color:"orange",data:this.error},{name:"stopped",color:"black",data:this.stopped}]})}});var a=new t.SessionCollection(dataObject.data),e=a.pluck("duration"),r=a.pluck("created_at"),i=a.pluck("summary_status"),n=[e,r,i];_.map(n,function(t){return t.pop()});for(var o=_.map(r,function(t){return t.split(/\s/)[0]}),s=_.uniq(o),d=date_duration_data_parse(r,e,o),l=date_status_data_parse(r,i,o),p=d.dur_sum,c=l.passed_arr,u=l.error_arr,h=l.failed_arr,m=l.stopped_arr,f=[],g=0;g<s.length;g++)f.push([s[g],p[g]]);var y=new t.DurationsItemView({data:f,days_data:s}),x=new t.StatusesItemView({days_data:s,passed:c,error:u,failed:h,stopped:m});y.render(),x.render()}var dataObject={};$(document).ready(function(){$("#csv-file").change(handleFileSelect)});